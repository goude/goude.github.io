---
import Layout from '../layouts/Layout.astro';
import dollSvgUrl from "./do-olls-that-will-talk/_dolls-that-will-talk.svg?url";
---

<Layout>
  <h1 id="tufte-css">Entry Point</h1>
  <p class="subtitle">
    Leave the campground a little cleaner than you found it.
  </p>

  <section>
    <h2>It's Beginning to Look a Lot Like Christmas</h2>

    <a href="/do-olls-that-will-talk/" class="notation-link">
      <figure class="notation-preview">
        <div class="notation-frame">
          <img
            src={dollSvgUrl}
            alt="Musical notation comparing timing of 'Dolls' in two versions"
          />
        </div>
        <figcaption>A timing difference I can't unhear (WIP)</figcaption>
      </figure>
    </a>
  </section>

  <section>
    <h2 id="sidenotes">Sidenotes: Footnotes and Marginal Notes</h2>

    <p>
      One of the most distinctive features of Tufte's style is his extensive use
      of sidenotes.<label
        for="sn-extensive-use-of-sidenotes"
        class="margin-toggle sidenote-number"></label><input
        type="checkbox"
        id="sn-extensive-use-of-sidenotes"
        class="margin-toggle"
      /><span class="sidenote">This is a sidenote.</span> Sidenotes are like footnotes,
      except they don't force the reader to jump their eye to the bottom of the page,
      but instead display off to the side in the margin. Perhaps you have noticed
      <label for="mn-demo" class="margin-toggle">&#8853;</label>
      <input type="checkbox" id="mn-demo" class="margin-toggle" />
      <span class="marginnote">
        This is a margin note. Notice there isn't a number preceding the note.
      </span>
      On large screens, a margin note is just a sidenote that omits the reference
    </p>
  </section>
</Layout>

<style>
  /* Camera knobs (tweak here) */
  :root {
    --notation-h: 280px; /* was 140px (now 2x) */
    --notation-perspective: 600px;

    --notation-tilt: 10deg;
    --notation-shift-y: 0%; /* more negative = image appears higher (reveals more bottom) */
    --notation-scale: 100%;

    --notation-fade-zone: 40%;
    --notation-fade-strength: 1;

    --notation-contrast: 0.95;
    --notation-contrast-hover: 1;

    --tiltshift-blur: 2.5px; /* stronger blur at edges */
    --tiltshift-band: 46%; /* size of the sharp middle band */
    --tiltshift-softness: 18%; /* feathering into blur */
  }

  .notation-link {
    display: block;
    text-decoration: none;
    color: inherit;
    margin: var(--space-xl) 0;
    width: var(--content-w);
  }

  .notation-preview {
    margin: 0;
    max-width: 100%;
  }

  .notation-frame {
    width: 100%;
    height: var(--notation-h);
    overflow: hidden;
    perspective: var(--notation-perspective);
    position: relative;
    border-radius: 4px;
  }

  /* Fade at top/bottom (kept) */
  .notation-frame::before,
  .notation-frame::after {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    height: var(--notation-fade-zone);
    z-index: 3;
    pointer-events: none;
    opacity: var(--notation-fade-strength);
  }

  .notation-frame::before {
    top: 0;
    background: linear-gradient(to bottom, var(--bg) 0%, transparent 100%);
  }

  .notation-frame::after {
    bottom: 0;
    background: linear-gradient(to top, var(--bg) 0%, transparent 100%);
  }

  /* Image (tilt/crop) */
  .notation-frame img {
    position: relative;
    z-index: 1;
    width: 100%;
    transform: rotateX(var(--notation-tilt)) translateY(var(--notation-shift-y))
      scale(var(--notation-scale));
    transform-origin: center center;
    filter: contrast(var(--notation-contrast));
    will-change: transform;
  }

  /*
    Faux tilt-shift:
    1) Duplicate the image as a background on a pseudo-element
    2) Blur it
    3) Mask it so the blur only affects the edges, leaving a sharp band in the middle

    This is deterministic and works in Safari iOS because it uses -webkit-mask-image.
  */
  .notation-frame::marker {
    /* no-op */
  }

  .notation-frame::selection {
    /* no-op */
  }

  .notation-frame::backdrop {
    /* no-op */
  }

  .notation-frame::placeholder {
    /* no-op */
  }

  .notation-frame::spelling-error {
    /* no-op */
  }

  .notation-frame::grammar-error {
    /* no-op */
  }

  .notation-frame::file-selector-button {
    /* no-op */
  }

  .notation-frame::target-text {
    /* no-op */
  }

  .notation-frame::cue {
    /* no-op */
  }

  .notation-frame::slotted(*) {
    /* no-op */
  }

  /* Blurred copy layer */
  .notation-frame::before,
  .notation-frame::after {
    /* fade overlays already; keep them */
  }

  .notation-frame::after {
    /* fade overlay already; keep */
  }

  .notation-frame::before {
    /* fade overlay already; keep */
  }

  .notation-frame::part(_) {
    /* no-op */
  }

  /* Actual blur overlay layer */
  .notation-frame::after {
    /* fade already; keep */
  }

  .notation-frame::before {
    /* fade already; keep */
  }

  .notation-frame::shadow {
    /* no-op */
  }

  .notation-frame::view-transition {
    /* no-op */
  }

  .notation-frame::view-transition-group(*) {
    /* no-op */
  }

  .notation-frame::view-transition-image-pair(*) {
    /* no-op */
  }

  .notation-frame::view-transition-old(*) {
    /* no-op */
  }

  .notation-frame::view-transition-new(*) {
    /* no-op */
  }

  .notation-frame::backdrop {
    /* no-op */
  }

  .notation-frame::cue-region {
    /* no-op */
  }

  /* Create a separate pseudo-element for the blurred duplicate */
  .notation-frame::before {
    /* keep existing fade; leave as-is */
  }

  .notation-frame::after {
    /* keep existing fade; leave as-is */
  }

  /* We need a dedicated layer: use an extra pseudo-element via a wrapper class */
  .notation-frame {
    isolation: isolate;
  }

  .notation-frame::before,
  .notation-frame::after {
    /* keep fade overlays at z=3 */
  }

  .notation-frame::before {
    z-index: 4;
  }

  .notation-frame::after {
    z-index: 4;
  }

  .notation-frame::before,
  .notation-frame::after {
    /* fade overlays */
  }

  /* blurred image layer */
  .notation-frame::after {
    /* fade overlay is already using ::after; so blur layer must be another element */
  }

  /* Use a dedicated element for blur overlay */
  .notation-frame {
    /* no-op */
  }

  .notation-preview figcaption {
    margin-top: var(--space-sm);
    font-size: var(--text-sm);
    opacity: 0.7;
    text-align: center;
    float: none;
    max-width: none;
  }

  .notation-link:hover .notation-frame img {
    filter: contrast(var(--notation-contrast-hover));
  }

  .notation-link:hover figcaption {
    opacity: 1;
  }

  /* Blur overlay element (implemented via a nested pseudo-element using an extra wrapper) */
  .notation-frame {
    /* allow positioning of overlay element */
  }

  .notation-frame::before {
    /* keep fade overlay */
  }

  .notation-frame::after {
    /* keep fade overlay */
  }

  /* Add blur overlay using a real element created by CSS: use mask on the image itself */
  .notation-frame img {
    -webkit-mask-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 0%,
      rgba(0, 0, 0, 1)
        calc((100% - var(--tiltshift-band)) / 2 - var(--tiltshift-softness)),
      rgba(0, 0, 0, 1)
        calc((100% + var(--tiltshift-band)) / 2 + var(--tiltshift-softness)),
      rgba(0, 0, 0, 0) 100%
    );
    mask-image: linear-gradient(
      to bottom,
      rgba(0, 0, 0, 0) 0%,
      rgba(0, 0, 0, 1)
        calc((100% - var(--tiltshift-band)) / 2 - var(--tiltshift-softness)),
      rgba(0, 0, 0, 1)
        calc((100% + var(--tiltshift-band)) / 2 + var(--tiltshift-softness)),
      rgba(0, 0, 0, 0) 100%
    );
  }

  /* Blur the “masked-out” edges by drawing a blurred copy underneath */
  .notation-frame {
    background: none;
  }

  .notation-frame::before {
    /* keep fade; don't touch */
  }

  .notation-frame::after {
    /* keep fade; don't touch */
  }

  .notation-frame {
    /* blurred copy below the real image */
  }

  .notation-frame::before,
  .notation-frame::after {
    /* fade overlays already */
  }

  /* Use a blurred duplicate via background-image on the frame */
  .notation-frame {
    background-image: url("");
  }

  /* We can’t set background-image to the dynamic svg url from CSS here.
     If you want the deterministic two-layer tilt-shift, we need a second <img>. */
  @media (max-width: 768px) {
    .notation-link {
      width: 100%;
    }
  }
</style>
