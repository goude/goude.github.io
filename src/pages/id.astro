---
import BaseLayout from "../layouts/BaseLayout.astro";

const title = "goude.se ID Page";
const description = "It's all about connecting.";
const permalink = Astro.site?.href ?? "https://goude.se/";
---

<BaseLayout
  title={title}
  description={description}
  permalink={permalink}
  current="home"
>
  <section>
    <script
      is:inline
      src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"
      defer></script>

    <style>
      #id-text {
        font-family: monospace;
        font-size: 1.2rem;
        margin-bottom: 1rem;
        background: #f0f0f0;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        display: inline-block;
      }

      canvas {
        margin-top: 1.5rem;
        box-shadow: 0 0 8px rgba(0, 0, 0, 0.15);
      }
    </style>

    <div id="id-text">Loading...</div>
    <canvas id="qr"></canvas>

    <script is:inline>
      document.addEventListener("DOMContentLoaded", () => {
        const canvas = document.getElementById("qr");
        const ctx = canvas.getContext("2d");
        const idText = document.getElementById("id-text");

        const params = new URLSearchParams(window.location.search);
        const id = params.get("id") || "unknown";
        const text = `https://goude.se/id?id=${encodeURIComponent(id)}`;
        idText.textContent = text;

        const tmpCanvas = document.createElement("canvas");

        QRCode.toCanvas(tmpCanvas, text, { margin: 2 }, (err) => {
          if (err) {
            idText.textContent = "QR generation failed.";
            return;
          }

          const qrSize = tmpCanvas.width;
          const padding = 10;
          const textHeight = 14;

          canvas.width = qrSize;
          canvas.height = qrSize + padding + textHeight;

          ctx.drawImage(tmpCanvas, 0, 0);
          ctx.font = "12px sans-serif";
          ctx.fillStyle = "#333";
          ctx.textAlign = "center";
          ctx.fillText(text, qrSize / 2, qrSize + padding + 10);
        });
      });
    </script>
  </section>
</BaseLayout>
