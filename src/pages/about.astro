---
import Layout from "@/layouts/Layout.astro";
---

<Layout title="About - goude.se" description="About goude.se" current="about">
  <section>
    <h1 id="colophon">About</h1>
    <p>
      <a
        href="https://www.buymeacoffee.com/goude"
        target="_blank"
        rel="noopener noreferrer"
        class="no-style-link"
      >
        <img
          src="https://cdn.buymeacoffee.com/buttons/v2/default-blue.png"
          alt="Buy Me A Coffee"
          style="height: 60px; width: 217px;"
          loading="lazy"
        />
      </a>
    </p>
  </section>

  <section>
    <h2>Adage Experiment</h2>
    <div class="epigraph">
      <blockquote>
        <p id="adage">
          The English language . . . becomes ugly and inaccurate because our
          thoughts are foolish, but the slovenliness of our language makes it
          easier for us to have foolish thoughts.
        </p>
        <footer><span id="attribution"></span></footer>
      </blockquote>
    </div>

    <script>
      interface AdageFile {
        name: string;
      }

      async function fetchRandomAdage(): Promise<void> {
        const githubApiUrl =
          "https://api.github.com/repos/goude/adages/contents/adages";
        const rawContentBaseUrl =
          "https://raw.githubusercontent.com/goude/adages/master/adages/";

        try {
          const allowedFileNames = ["boot-messages", "wwdits"];

          const listResponse = await fetch(githubApiUrl);
          const fileList: AdageFile[] = await listResponse.json();
          const filteredFileList = fileList.filter((file) =>
            allowedFileNames.includes(file.name)
          );
          const randomFileName =
            filteredFileList[
              Math.floor(Math.random() * filteredFileList.length)
            ].name;

          const fileUrl = `${rawContentBaseUrl}${randomFileName}`;
          const fileResponse = await fetch(fileUrl);
          const fileContent = await fileResponse.text();

          const adages = fileContent.split("%");
          const randomAdage =
            adages[Math.floor(Math.random() * adages.length)].trim();

          const match = randomAdage.match(/^(.*?)(?:\s*â€“\s*(.*))?$/);
          const adage = match ? match[1].trim() : randomAdage;
          const attribution = match && match[2] ? match[2].trim() : "";

          const formattedAdage = adage.replace(/\n/g, "<br>");
          const adageElement = document.getElementById("adage");
          const attributionElement = document.getElementById("attribution");

          if (adageElement) adageElement.innerHTML = formattedAdage;
          if (attributionElement) attributionElement.innerHTML = attribution;
        } catch (error) {
          console.error("Error fetching adage:", error);
          const adageElement = document.getElementById("adage");
          if (adageElement) adageElement.textContent = "Failed to load adage.";
        }
      }

      fetchRandomAdage();
    </script>
  </section>

  <section>
    <h2>Everyday Carry</h2>
    <ul>
      <li>A Permanent Marker</li>
    </ul>
  </section>
</Layout>
