---
import pkg from "../../package.json";

const now = new Date();

function getISOWeek(d) {
  const dLocal = new Date(d.getFullYear(), d.getMonth(), d.getDate());
  const isoDow = dLocal.getDay() === 0 ? 7 : dLocal.getDay();
  const th = new Date(dLocal);
  th.setDate(th.getDate() + (4 - isoDow));
  const weekYear = th.getFullYear();
  const jan4 = new Date(weekYear, 0, 4);
  const jan4IsoDow = jan4.getDay() === 0 ? 7 : jan4.getDay();
  const week1Mon = new Date(weekYear, 0, 4 - (jan4IsoDow - 1));
  const toUTCmid = (x) => Date.UTC(x.getFullYear(), x.getMonth(), x.getDate());
  const daysSinceWeek1Mon = Math.round(
    (toUTCmid(th) - toUTCmid(week1Mon)) / 86400000,
  );
  return Math.floor(daysSinceWeek1Mon / 7) + 1;
}

const pad = (n) => String(n).padStart(2, "0");
const week = getISOWeek(now);

const build = new Date(__BUILD_TIMESTAMP__ as unknown as number | string);
const builtDate = `${build.getUTCFullYear()}-${pad(build.getUTCMonth() + 1)}-${pad(build.getUTCDate())}`;
const builtTime = `${pad(build.getUTCHours())}:${pad(build.getUTCMinutes())}`;
---

<footer class="site-footer">
  <span class="chunk">
    © {now.getFullYear()}
    <a href="https://goude.se">goude.se</a>
  </span>

  <span class="sep" aria-hidden="true">·</span>

  <span class="chunk">
    <a href="/rubiks" title="ISO week (Sweden: SS-ISO 8601-1)">Week {week}</a>
  </span>

  <span class="sep" aria-hidden="true">·</span>

  <span class="chunk">
    <a href="/sitemap">v{pkg.version}</a>
  </span>

  <span class="sep" aria-hidden="true">·</span>

  <span class="chunk nowrap">
    Built {builtDate}<span class="faded">T</span>{builtTime}Z
  </span>

  <span class="sep" aria-hidden="true">·</span>

  <span class="chunk">
    <span title="sigil" aria-label="sigil">⊛</span>
  </span>
</footer>

<style>
  .site-footer {
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    gap: 0.35rem;
  }

  .chunk {
    display: inline-flex;
    align-items: baseline;
    gap: 0.35rem;
  }

  .sep {
    opacity: 0.35;
  }

  .nowrap {
    white-space: nowrap;
  }

  .faded {
    opacity: 0.3;
  }
</style>
