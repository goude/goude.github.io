---
import pkg from "../../package.json";

const now = new Date();

// Get ISO Week Number
const getISOWeek = (date: Date) => {
  const temp = new Date(date);
  temp.setUTCDate(temp.getUTCDate() + 4 - (temp.getUTCDay() || 7));
  const start = new Date(Date.UTC(temp.getUTCFullYear(), 0, 1));
  return Math.ceil(((temp.getTime() - start.getTime()) / 86400000 + 1) / 7);
};

const pad = (n: number) => String(n).padStart(2, "0");

const week = getISOWeek(now);
const build = new Date(__BUILD_TIMESTAMP__);

const buildParts = {
  date: `${build.getFullYear()}-${pad(build.getMonth() + 1)}-${pad(build.getDate())}`,
  time: `${pad(build.getHours())}:${pad(build.getMinutes())}`,
};

const nowParts = {
  date: `${now.getFullYear()}-${pad(now.getMonth() + 1)}-${pad(now.getDate())}`,
  time: `${pad(now.getHours())}:${pad(now.getMinutes())}`,
};

const tzOffset = -now.getTimezoneOffset();
const sign = tzOffset >= 0 ? "+" : "-";
const tzH = pad(Math.floor(Math.abs(tzOffset) / 60));
const tzM = pad(Math.abs(tzOffset) % 60);
const tz = `${sign}${tzH}:${tzM}`;
---

<style>
  .faded {
    opacity: 0.2;
  }
  .clickable {
    cursor: pointer;
    text-decoration: underline dotted;
  }
</style>

<footer>
  © {now.getFullYear()}
  <a href="https://goude.se">goude.se</a> · Week {week} · v{pkg.version} ·
  {buildParts.date}<span class="faded">T</span>{buildParts.time} ·
  <a href={`/id/${nowParts.date}T${nowParts.time}`}>
    {nowParts.date}<span class="faded">T</span>{nowParts.time}</a
  >{tz}
</footer>
