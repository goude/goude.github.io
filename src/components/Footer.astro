---
import { getISOWeek } from "@/utils";
import pkg from "../../package.json";

const version = pkg.version;

const now = new Date();
const week = getISOWeek(now);
const year = now.getFullYear();

const weekday = now.toLocaleDateString("en-GB", { weekday: "short" });
const day = now.getDate().toString().padStart(2, "0");
const hours = now.getHours().toString().padStart(2, "0");
const minutes = now.getMinutes().toString().padStart(2, "0");

const stamp = `W${week} ${weekday} ${day} ${hours}:${minutes}`;

/* Swatch data structure */
const swatches = [
  { var: "--palette-light-bg", desc: "Light background", url: "/cop" },
  { var: "--palette-light-fg", desc: "Light foreground", url: "/t/markup" },
  { var: "--palette-light-accent", desc: "Light accent", url: "/t/computers" },

  { var: "--palette-dark-bg", desc: "Dark background", url: "/t/knowledge" },
  {
    var: "--palette-dark-fg",
    desc: "Dark foreground",
    url: "/v/toppen-fjaderhjalmar/index.html",
  },
  { var: "--palette-dark-accent", desc: "Dark accent", url: "/t/sheev" },

  { var: "--accent-green", desc: "Accent green", url: "https://goude.se" },
  { var: "--accent-blue", desc: "Accent blue", url: "https://goude.se" },
  { var: "--accent-purple", desc: "Accent purple", url: "https://goude.se" },
  { var: "--accent-yellow", desc: "Accent yellow", url: "https://goude.se" },
  { var: "--accent-red", desc: "Accent red", url: "https://goude.se" },
];
---

<footer class="site-footer">
  <span class="chunk">
    © {year}
    <a href="https://goude.se">goude.se</a>
  </span>

  <span class="sep" aria-hidden="true">·</span>

  <span class="chunk">
    <a href="/" title="ISO week + current timestamp">{stamp}</a>
  </span>

  <span class="sep" aria-hidden="true">·</span>

  <span class="chunk">
    <a href="/">v{version}</a>
  </span>

  <span class="sep" aria-hidden="true">·</span>

  <span class="chunk">
    <span
      id="copy-link-snippet"
      title="Copy link snippet for this page"
      style="cursor:pointer;"><i class="fa-solid fa-link"></i></span
    >
  </span>

  <div class="swatches">
    {
      swatches.map((s) => (
        <span
          data-url={s.url}
          title={`${s.desc} — ${s.url} — ${s.var}`}
          style={`background: var(${s.var})`}
        />
      ))
    }
  </div>
</footer>

<script is:inline>
  document.querySelectorAll(".swatches span").forEach((el) => {
    el.addEventListener("click", () => {
      const url = el.dataset.url;
      if (!url) return;
      window.location.href = url;
    });
  });

  const linkBtn = document.getElementById("copy-link-snippet");
  if (linkBtn) {
    linkBtn.addEventListener("click", () => {
      const path = window.location.pathname;
      const title = document.title.replace(/\s*[-–—].*$/, "");
      const snippet = `<a href="${path}">${title}</a>`;
      navigator.clipboard.writeText(snippet);

      linkBtn.classList.remove("pulse");
      void linkBtn.offsetWidth;
      linkBtn.classList.add("pulse");
    });
  }
</script>

<style>
  .site-footer {
    font-family: var(--font-ui);
    font-size: 1rem;
    display: flex;
    flex-wrap: wrap;
    align-items: baseline;
    justify-content: center;
    gap: 0.35rem;
    padding: var(--space-lg) 0;
    margin-top: auto;
  }

  .chunk {
    display: inline-flex;
    align-items: baseline;
    gap: 0.35rem;
  }

  .sep {
    opacity: 0.35;
  }

  .swatches {
    width: 100%;
    display: flex;
    justify-content: center;
    gap: 0.35rem;
    margin-top: 0.5rem;
  }

  .swatches span {
    width: 0.9em;
    height: 0.9em;
    display: inline-block;
    border-radius: 2px;
    border: 1px solid var(--border);
    cursor: pointer;
  }

  #copy-link-snippet.pulse i {
    animation: pulse-glow 0.8s ease-out;
  }

  @keyframes pulse-glow {
    0% {
      text-shadow: 0 0 0 var(--accent-blue);
      transform: scale(1);
    }
    15% {
      text-shadow:
        0 0 6px var(--accent-blue),
        0 0 12px var(--accent-blue);
      transform: scale(1.2);
    }
    100% {
      text-shadow: 0 0 0 var(--accent-blue);
      transform: scale(1);
    }
  }
</style>
