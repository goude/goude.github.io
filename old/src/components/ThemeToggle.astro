---
// src/components/ThemeToggle.astro
---

<button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
  <i class="fa-regular fa-sun" id="icon-light" aria-hidden="true"></i>
  <i class="fa-solid fa-moon" id="icon-dark" aria-hidden="true"></i>
</button>

<style>
  .theme-toggle {
    background: none;
    border: none;
    font-size: 1.1em;
    cursor: pointer;
    padding: 0.25rem 0.6rem;
    color: inherit;
  }

  .theme-toggle:hover {
    opacity: 0.7;
  }

  #icon-dark {
    display: none;
  }

  :global([data-theme-dark]) #icon-light {
    display: none;
  }
  :global([data-theme-dark]) #icon-dark {
    display: inline;
  }
</style>

<script is:inline>
  (function () {
    function storedTheme() {
      const t = localStorage.getItem("theme");
      return t === "dark" || t === "light" ? t : null;
    }

    function systemTheme() {
      return window.matchMedia?.("(prefers-color-scheme: dark)").matches
        ? "dark"
        : "light";
    }

    function apply(theme) {
      const root = document.documentElement;
      root.toggleAttribute("data-theme-dark", theme === "dark");
      root.toggleAttribute("data-theme-light", theme === "light");
    }

    function currentTheme() {
      return storedTheme() ?? systemTheme();
    }

    apply(currentTheme());

    document.getElementById("theme-toggle").addEventListener("click", () => {
      const isDark = document.documentElement.hasAttribute("data-theme-dark");
      const next = isDark ? "light" : "dark";
      localStorage.setItem("theme", next);
      apply(next);
    });

    window
      .matchMedia?.("(prefers-color-scheme: dark)")
      .addEventListener("change", () => {
        if (!storedTheme()) apply(systemTheme());
      });
  })();
</script>
