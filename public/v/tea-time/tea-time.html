<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tea Temperature Dynamics</title>
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ü´ñ</text></svg>"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;600&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <link rel="stylesheet" href="style.css" />
    <style>
      /* Dual-handle range slider styles */
      .range-slider {
        position: relative;
        height: 6px;
        background: var(--surface-raised);
        border-radius: 3px;
        margin: 10px 0;
      }

      .range-slider-track {
        position: absolute;
        height: 100%;
        background: var(--drinkable);
        border-radius: 3px;
        opacity: 0.5;
      }

      .range-slider input[type="range"] {
        position: absolute;
        width: 100%;
        height: 6px;
        background: transparent;
        pointer-events: none;
        -webkit-appearance: none;
        margin: 0;
        top: 0;
      }

      .range-slider input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        width: 18px;
        height: 18px;
        background: var(--accent);
        border-radius: 50%;
        cursor: pointer;
        pointer-events: auto;
        position: relative;
        z-index: 2;
      }

      .range-slider input[type="range"]::-moz-range-thumb {
        width: 18px;
        height: 18px;
        background: var(--accent);
        border-radius: 50%;
        cursor: pointer;
        pointer-events: auto;
        border: none;
      }

      .range-values {
        display: flex;
        justify-content: space-between;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.75rem;
        color: var(--accent);
        margin-top: 0.5rem;
      }

      /* Timer context info */
      .timer-context {
        display: flex;
        justify-content: center;
        gap: 1.5rem;
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.5rem;
        padding-top: 0.5rem;
      }

      .timer-context-item {
        display: flex;
        align-items: center;
        gap: 0.35rem;
      }

      .timer-context-item i {
        color: var(--accent-dim);
        font-size: 0.7rem;
      }

      /* Live model params in measurement section */
      .live-params {
        background: var(--surface-raised);
        border-radius: var(--radius);
        padding: 0.75rem;
        margin-top: 0.75rem;
        font-family: "JetBrains Mono", monospace;
        font-size: 0.7rem;
        color: var(--text-muted);
        line-height: 1.6;
      }

      .live-params-title {
        font-size: 0.65rem;
        color: var(--accent-dim);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 0.5rem;
      }

      .live-params-row {
        display: flex;
        justify-content: space-between;
      }

      .live-params-value {
        color: var(--accent);
      }

      .live-params-insufficient {
        color: var(--accent-dim);
        font-style: italic;
        text-align: center;
        padding: 0.5rem;
      }

      /* Collapsible log section */
      .log-toggle {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: pointer;
        padding: 0.5rem 0;
        border-top: 1px solid var(--accent-dim);
        margin-top: 1rem;
      }

      .log-toggle-title {
        font-size: 0.7rem;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.05em;
      }

      .log-toggle-icon {
        font-size: 0.6rem;
        color: var(--accent-dim);
        transition: transform 0.2s;
      }

      .log-toggle-icon.open {
        transform: rotate(180deg);
      }

      .log-content {
        max-height: 0;
        overflow: hidden;
        transition: max-height 0.3s ease;
      }

      .log-content.open {
        max-height: 500px;
      }

      .log-inner {
        padding-top: 0.75rem;
      }
      .signature-name a,
      .signature-name a:visited {
        color: var(--accent);
        text-decoration: none;
      }

      .signature-name a:hover {
        text-decoration: underline;
      }
    </style>
  </head>
  <body>
    <div class="chart-overlay" id="chartOverlay">
      <canvas id="overlayChart"></canvas>
    </div>

    <button class="sticky-toggle" id="stickyToggle">
      <svg
        width="16"
        height="16"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
      >
        <path d="M4 6h16M4 12h16M4 18h16" />
      </svg>
      <span id="toggleText">Pin Graph</span>
    </button>

    <div class="container">
      <header>
        <a href="/" class="logo" title="Back to the top.">
          <i class="fa-solid fa-bullseye" aria-hidden="true"></i>
          <span class="sr-only">Home</span>
        </a>
        <h1>Tea Temperature Dynamics</h1>
        <div class="subtitle">Two-Exponential Cooling Model</div>
      </header>

      <!-- Real-time Timer -->
      <div class="timer-section">
        <div class="current-temp-label">Live Timer</div>
        <div class="timer-display" id="timerDisplay">0:00</div>
        <div class="timer-phase" id="timerPhase">Ready to start</div>
        <div class="timer-instruction" id="timerInstruction">
          Press Start to begin countdown
        </div>
        <div class="timer-buttons">
          <button class="timer-btn primary" id="timerStartBtn">Start</button>
        </div>
        <div class="timer-context" id="timerContext">
          <div class="timer-context-item">
            <i class="fa-solid fa-leaf"></i>
            <span id="timerTeaType">Black Tea</span>
          </div>
          <div class="timer-context-item">
            <i class="fa-solid fa-mug-hot"></i>
            <span id="timerCupType">Burleigh Blue Calico</span>
          </div>
        </div>
        <a
          href="#tab-howto"
          class="timer-help-link"
          onclick="document.querySelector('[data-tab=howto]').click()"
          >First time? See instructions ‚Üì</a
        >
      </div>

      <div class="markers-info">
        <div class="marker-card">
          <div class="marker-card-label" id="addTeaLabel">Add Tea At</div>
          <div class="marker-card-value add" id="addTeaTime">0:00</div>
        </div>
        <div class="marker-card">
          <div class="marker-card-label" id="removeTeaLabel">Remove Tea At</div>
          <div class="marker-card-value remove" id="removeTeaTime">4:00</div>
        </div>
        <div class="marker-card">
          <div class="marker-card-label" id="drinkableLabel">Drinkable At</div>
          <div class="marker-card-value drinkable" id="drinkableTime">--</div>
        </div>
      </div>

      <div class="chart-section">
        <div class="chart-container">
          <div class="chart-wrapper">
            <canvas id="tempChart"></canvas>
          </div>
          <div class="chart-legend">
            <div class="legend-item">
              <span class="legend-dot steep"></span> Steeping
            </div>
            <div class="legend-item">
              <span class="legend-dot cool"></span> Cooling
            </div>
            <div class="legend-item">
              <span class="legend-dot drinkable"></span> Ideal
            </div>
            <div class="legend-item">
              <span class="legend-dot cold"></span> Cold
            </div>
            <div class="legend-item">
              <span class="legend-marker add"></span> Add tea
            </div>
            <div class="legend-item">
              <span class="legend-marker remove"></span> Remove tea
            </div>
          </div>
          <div class="time-scrubber">
            <div class="time-display">
              Time: <span id="timeDisplay">0:00</span>
            </div>
            <input type="range" id="timeScrubber" min="0" max="100" value="0" />
          </div>
        </div>
      </div>

      <!-- Tea & Cup Selection (combined) -->
      <div class="controls-section">
        <div class="section-title">Tea & Cup Selection</div>
        <div class="control-group">
          <div class="control-label"><label>Tea Type</label></div>
          <div class="select-wrapper">
            <select id="teaType">
              <option value="black">Black Tea (95¬∞C, 4 min)</option>
              <option value="green">Green Tea (80¬∞C, 2 min)</option>
              <option value="white">White Tea (75¬∞C, 3 min)</option>
              <option value="oolong">Oolong Tea (90¬∞C, 3 min)</option>
              <option value="herbal">Herbal Infusion (100¬∞C, 5 min)</option>
              <option value="rooibos">Rooibos (100¬∞C, 5 min)</option>
              <option value="custom">Custom Settings</option>
            </select>
          </div>
        </div>
        <div class="control-group">
          <div class="control-label"><label>Cup Preset</label></div>
          <div class="select-wrapper">
            <select id="cupPreset">
              <option value="burleigh">Burleigh Blue Calico (measured)</option>
              <option value="preheated">Pre-heated ceramic</option>
              <option value="thin_ceramic">Thin ceramic / porcelain</option>
              <option value="thick_ceramic">Thick stoneware mug</option>
              <option value="glass">Glass cup</option>
              <option value="insulated">Insulated / double-wall</option>
              <option value="paper">Paper cup</option>
              <option value="custom">Custom parameters</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Brew Parameters (including drinking zone) -->
      <div class="controls-section">
        <div class="section-title">Brew Parameters</div>
        <div class="control-group">
          <div class="control-label">
            <label>Add Tea at Temperature</label>
            <span class="control-value" id="brewTempValue">95¬∞C</span>
          </div>
          <input type="range" id="brewTemp" min="70" max="100" value="95" />
        </div>
        <div class="control-group">
          <div class="control-label">
            <label>Steep Time</label>
            <span class="control-value" id="steepTimeValue">4 min</span>
          </div>
          <input
            type="range"
            id="steepTime"
            min="0.5"
            max="10"
            value="4"
            step="0.5"
          />
        </div>
        <div class="control-group">
          <div class="control-label">
            <label>Drinking Zone</label>
          </div>
          <div class="range-slider" id="drinkingZoneSlider">
            <div class="range-slider-track" id="drinkingZoneTrack"></div>
            <input type="range" id="coldTemp" min="42" max="75" value="50" />
            <input
              type="range"
              id="drinkableTemp"
              min="42"
              max="75"
              value="70"
            />
          </div>
          <div class="range-values">
            <span>Cold: <span id="coldTempValue">50¬∞C</span></span>
            <span>Safe: <span id="drinkableTempValue">70¬∞C</span></span>
          </div>
        </div>
      </div>

      <!-- Model Parameters -->
      <div class="controls-section">
        <div class="section-title">Model Parameters</div>

        <div class="control-group">
          <div class="control-label">
            <label>Room Temperature (T<sub>amb</sub>)</label>
            <span class="control-value" id="roomTempValue">20¬∞C</span>
          </div>
          <input type="range" id="roomTemp" min="15" max="30" value="20" />
        </div>

        <div class="control-group">
          <div class="control-label">
            <label>A‚ÇÅ (ceramic absorption)</label>
            <span class="control-value" id="A1Value">14.0¬∞C</span>
          </div>
          <input
            type="range"
            id="A1Slider"
            min="0"
            max="40"
            value="14.0"
            step="0.1"
          />
        </div>

        <div class="control-group">
          <div class="control-label">
            <label>k‚ÇÅ (ceramic rate)</label>
            <span class="control-value" id="k1Value">0.350 min‚Åª¬π</span>
          </div>
          <input
            type="range"
            id="k1Slider"
            min="0.05"
            max="1.0"
            value="0.35"
            step="0.005"
          />
        </div>

        <div class="control-group">
          <div class="control-label">
            <label>A‚ÇÇ (initial excess temp)</label>
            <span class="control-value" id="A2Value">56.0¬∞C</span>
          </div>
          <input
            type="range"
            id="A2Slider"
            min="30"
            max="80"
            value="56.0"
            step="0.1"
          />
        </div>

        <div class="control-group">
          <div class="control-label">
            <label>k‚ÇÇ (air cooling rate)</label>
            <span class="control-value" id="k2Value">0.022 min‚Åª¬π</span>
          </div>
          <input
            type="range"
            id="k2Slider"
            min="0.005"
            max="0.100"
            value="0.022"
            step="0.001"
          />
        </div>
      </div>

      <div class="info-tabs">
        <div class="tab-buttons">
          <button class="tab-btn active" data-tab="howto">How To</button>
          <button class="tab-btn" data-tab="model">The Model</button>
          <button class="tab-btn" data-tab="xanthines">Xanthines</button>
          <button class="tab-btn" data-tab="tea">Tea Guide</button>
          <button class="tab-btn" data-tab="tips">Temperatures</button>
        </div>

        <div class="tab-content active" id="tab-howto">
          <h3>How to Use This Timer</h3>
          <div class="step">
            <div class="step-num">1</div>
            <div class="step-content">
              <div class="step-title">Boil water</div>
              <div class="step-detail">
                Bring fresh water to a rolling boil (100¬∞C).
              </div>
            </div>
          </div>
          <div class="step">
            <div class="step-num">2</div>
            <div class="step-content">
              <div class="step-title">Press Start</div>
              <div class="step-detail">
                A 5-second countdown begins. Pour when it says "Pour now!"
              </div>
            </div>
          </div>
          <div class="step">
            <div class="step-num">3</div>
            <div class="step-content">
              <div class="step-title">Wait for "Add Tea" alert</div>
              <div class="step-detail">
                When water reaches <span id="howtoBrewTemp">95¬∞C</span>, add
                your tea leaves or bag.
              </div>
            </div>
          </div>
          <div class="step">
            <div class="step-num">4</div>
            <div class="step-content">
              <div class="step-title">Remove tea at steep end</div>
              <div class="step-detail">
                After <span id="howtoSteepTime">4 minutes</span> of steeping,
                remove the tea.
              </div>
            </div>
          </div>
          <div class="step">
            <div class="step-num">5</div>
            <div class="step-content">
              <div class="step-title">Wait for drinkable temperature</div>
              <div class="step-detail">
                The timer shows when tea reaches
                <span id="howtoDrinkTemp">60¬∞C</span>.
              </div>
            </div>
          </div>
          <p style="margin-top: 1rem">
            <strong>Logging:</strong> Use the temperature slider below to record
            actual measurements for model calibration.
          </p>
        </div>

        <div class="tab-content" id="tab-model">
          <h3>Why Two Exponentials?</h3>
          <p>
            Simple Newton's Law assumes heat only flows to the air. But when you
            pour boiling water into a cold ceramic cup, two things happen:
          </p>
          <h4>Fast process: Ceramic equilibration</h4>
          <p>
            The cold cup absorbs heat from the water. A 252g ceramic cup at 20¬∞C
            can absorb enough heat to drop water temperature by 10-15¬∞C. This
            happens quickly (œÑ ‚âà 3-5 min).
          </p>
          <h4>Slow process: Air cooling</h4>
          <p>
            Heat escapes to the surrounding air via convection and radiation.
            This is slower (œÑ ‚âà 40-50 min) because air is a poor heat conductor.
          </p>
          <p>The two-exponential model captures both:</p>
          <p><code>T(t) = T_amb + A‚ÇÅ¬∑e^(-k‚ÇÅt) + A‚ÇÇ¬∑e^(-k‚ÇÇt)</code></p>
          <p>
            This reduces RMSE from ~2.4¬∞C (simple Newton) to ~0.5¬∞C, especially
            improving accuracy in the critical first 10 minutes.
          </p>
          <h4>Pre-heating eliminates A‚ÇÅ</h4>
          <p>
            If you pre-heat the cup with hot water first, A‚ÇÅ ‚Üí 0 and you get
            simple Newton cooling.
          </p>

          <!-- Equation box moved here -->
          <div class="equation-box-inline">
            <div class="equation-title">Two-Exponential Model Info</div>
            <div class="equation">
              T(t) = <span id="eqTambMain">20</span> +
              <span id="eqA1Main">14.0</span>¬∑e<sup
                >‚àí<span id="eqK1Main">0.350</span>t</sup
              >
              + <span id="eqA2Main">56.0</span>¬∑e<sup
                >‚àí<span id="eqK2Main">0.022</span>t</sup
              >
            </div>
            <div class="equation-section">
              <div class="equation-toggle" id="equationToggle">
                <span class="equation-section-title">Current Parameters</span>
                <span class="equation-toggle-icon" id="equationToggleIcon"
                  >‚ñº</span
                >
              </div>
              <div class="equation-details" id="equationDetails">
                <div class="equation-values">
                  T<sub>amb</sub> = <span id="eqTamb">20</span>¬∞C (ambient)<br />
                  A‚ÇÅ = <span id="eqA1">14.0</span>¬∞C, k‚ÇÅ =
                  <span id="eqK1">0.350</span> min‚Åª¬π (œÑ‚ÇÅ =
                  <span id="eqTau1">2.9</span> min) ‚Äî ceramic<br />
                  A‚ÇÇ = <span id="eqA2">56.0</span>¬∞C, k‚ÇÇ =
                  <span id="eqK2">0.022</span> min‚Åª¬π (œÑ‚ÇÇ =
                  <span id="eqTau2">45.5</span> min) ‚Äî air<br /><br />
                  <strong
                    >T(0) = T<sub>amb</sub> + A‚ÇÅ + A‚ÇÇ =
                    <span id="eqT0calc">90.0</span>¬∞C</strong
                  ><br />
                  Lower than 100¬∞C due to heat lost during pour and initial
                  ceramic contact.
                </div>
                <div class="equation-note">
                  Model fitted to Burleigh Blue Calico cup (252g earthenware,
                  275ml water, 20¬∞C room). RMSE ‚âà 0.5¬∞C.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="tab-content" id="tab-xanthines">
          <h3>Xanthines in Tea</h3>
          <p>
            Tea contains several methylxanthine alkaloids‚Äîpsychoactive compounds
            that affect the nervous system.
          </p>
          <h4>Caffeine (1,3,7-trimethylxanthine)</h4>
          <p>
            The primary stimulant. Blocks adenosine receptors, promoting
            alertness. Half-life: 3-7 hours.
          </p>
          <h4>Theophylline (1,3-dimethylxanthine)</h4>
          <p>Bronchodilator and mild stimulant. Used medically for asthma.</p>
          <h4>Theobromine (3,7-dimethylxanthine)</h4>
          <p>
            Milder stimulant than caffeine. Longer half-life (~7 hours). Also
            found in chocolate.
          </p>
          <table class="xanthine-table">
            <thead>
              <tr>
                <th>Tea Type</th>
                <th>Caffeine</th>
                <th>L-Theanine</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Black</td>
                <td>40-70mg</td>
                <td>24mg</td>
              </tr>
              <tr>
                <td>Oolong</td>
                <td>30-50mg</td>
                <td>~20mg</td>
              </tr>
              <tr>
                <td>Green</td>
                <td>20-45mg</td>
                <td>~20mg</td>
              </tr>
              <tr>
                <td>White</td>
                <td>15-30mg</td>
                <td>~18mg</td>
              </tr>
              <tr>
                <td>Herbal/Rooibos</td>
                <td>0mg</td>
                <td>0mg</td>
              </tr>
            </tbody>
          </table>
          <p><em>Values per 240ml cup.</em></p>
          <h4>L-Theanine</h4>
          <p>
            Not a xanthine, but notable: this amino acid unique to tea promotes
            calm alertness by increasing alpha brain waves, modulating
            caffeine's effects.
          </p>
        </div>

        <div class="tab-content" id="tab-tea">
          <h3>Optimal Brewing by Type</h3>
          <p><strong>Black tea:</strong> Add at 95¬∞C, steep 3-5 min.</p>
          <p><strong>Green tea:</strong> Add at 75-80¬∞C, steep 2-3 min.</p>
          <p><strong>White tea:</strong> Add at 75¬∞C, steep 3-5 min.</p>
          <p><strong>Oolong:</strong> Add at 85-90¬∞C, steep 2-4 min.</p>
          <p><strong>Herbal infusions:</strong> Add at 100¬∞C, steep 5-7 min.</p>
          <p>
            <strong>Rooibos:</strong> Add at 100¬∞C, steep 5-7 min. Won't turn
            bitter.
          </p>
        </div>

        <div class="tab-content" id="tab-tips">
          <h3>Temperature Zones</h3>
          <p>
            <strong>Above 65¬∞C:</strong> Risk of oral burns. WHO classifies
            beverages above 65¬∞C as "probably carcinogenic" with repeated
            exposure.
          </p>
          <p>
            <strong>60-65¬∞C:</strong> Hot but generally safe. Flavor compounds
            are volatile.
          </p>
          <p>
            <strong>55-60¬∞C:</strong> Comfortable drinking zone for most people.
          </p>
          <p>
            <strong>45-55¬∞C:</strong> Lukewarm. Flavor becomes less vibrant.
          </p>
          <p>
            <strong>Below 45¬∞C:</strong> Cold tea. Different flavor profile.
          </p>
          <p>
            The chart shows a
            <span style="color: var(--drinkable)">blue "ideal" zone</span>
            between your drinkable temperature and the "too cold" threshold, and
            a <span style="color: var(--cold)">gray "cold" zone</span> below
            that.
          </p>
        </div>
      </div>

      <!-- Temperature logging section -->
      <div class="controls-section measurement-section" id="measurementSection">
        <div class="section-title">Temperature Logging</div>
        <div class="control-group">
          <div class="control-label">
            <label>Measured Temperature</label>
            <span class="control-value" id="measuredTempValue">90¬∞C</span>
          </div>
          <input
            type="range"
            id="measuredTemp"
            min="30"
            max="100"
            value="90"
            step="1"
          />
        </div>
        <div class="measurement-buttons">
          <button class="timer-btn primary" id="logTempBtn" disabled>
            <i class="fa-solid fa-plus"></i> Log Temperature
          </button>
          <button class="timer-btn secondary" id="undoLogBtn" disabled>
            <i class="fa-solid fa-undo"></i> Undo
          </button>
        </div>

        <!-- Live model parameters from logged data -->
        <div class="live-params" id="liveParams">
          <div class="live-params-title">
            Fitted Parameters (from this session)
          </div>
          <div class="live-params-insufficient" id="liveParamsInsufficient">
            Need ‚â•3 measurements to fit model
          </div>
          <div id="liveParamsContent" style="display: none">
            <div class="live-params-row">
              <span>T<sub>amb</sub></span>
              <span class="live-params-value" id="liveParamTamb">--</span>
            </div>
            <div class="live-params-row">
              <span>A‚ÇÅ</span>
              <span class="live-params-value" id="liveParamA1">--</span>
            </div>
            <div class="live-params-row">
              <span>k‚ÇÅ</span>
              <span class="live-params-value" id="liveParamK1">--</span>
            </div>
            <div class="live-params-row">
              <span>A‚ÇÇ</span>
              <span class="live-params-value" id="liveParamA2">--</span>
            </div>
            <div class="live-params-row">
              <span>k‚ÇÇ</span>
              <span class="live-params-value" id="liveParamK2">--</span>
            </div>
            <div
              class="live-params-row"
              style="
                margin-top: 0.5rem;
                padding-top: 0.5rem;
                border-top: 1px solid var(--accent-dim);
              "
            >
              <span>RMSE</span>
              <span class="live-params-value" id="liveParamRMSE">--</span>
            </div>
          </div>
        </div>

        <!-- Collapsible measurement log -->
        <div class="log-toggle" id="logToggle">
          <span class="log-toggle-title">Measurement Log</span>
          <span class="log-toggle-icon" id="logToggleIcon">‚ñº</span>
        </div>
        <div class="log-content" id="logContent">
          <div class="log-inner">
            <p class="log-description">
              Copy this YAML data for model calibration. Log persists across
              resets but clears on page reload.
            </p>
            <textarea
              id="measurementLog"
              class="measurement-log"
              readonly
              placeholder="Start a timer session to begin logging..."
            ></textarea>
            <button class="timer-btn secondary copy-btn" id="copyLogBtn">
              <i class="fa-solid fa-copy"></i> Copy to Clipboard
            </button>
          </div>
        </div>
      </div>

      <div class="signature">
        <div class="signature-text">Crafted with care by</div>
        <div class="signature-name">
          <a href="https://goude.se">#doitpoorly</a> &amp; Claude AI
        </div>
      </div>
    </div>
    <script src="script.js"></script>
  </body>
</html>
