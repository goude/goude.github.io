Without breaking what works, with minimal line diffs, and giving the whole file back, please take the complete code file provided, apply the required updates directly, and return the entire file in full. Make the smallest possible set of changes. Preserve all existing functionality. Do not refactor, rename, reorder, or restyle code unless strictly required to implement the requested change. Do not introduce new abstractions, indentation changes, or formatting differences beyond what is necessary for correctness. When reporting back what you did tell what you did (not what you did not do). So give back the WHOLE file without skipping anything, for easy copying/pasting. Thx.

